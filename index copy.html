<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <title>–ì—Ä–∞: –°–∫—ñ–ª—å–∫–∏ –º—ñ—Å—Ü—è –∑–∞–π–º–∞—é—Ç—å —Ç–≤–æ—ó —Ñ–∞–π–ª–∏?</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 0;
      background: #0f172a;
      color: #e5e7eb;
      display: flex;
      justify-content: center;
    }
    .app {
      max-width: 1100px;
      width: 100%;
      padding: 24px 16px 40px;
    }
    h1 {
      margin-top: 0;
      text-align: center;
      font-size: 1.8rem;
    }
    .card {
      background: #111827;
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 18px 40px rgba(0,0,0,0.45);
      border: 1px solid #1f2937;
    }
    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      justify-content: center;
      margin-bottom: 16px;
    }
    button {
      border-radius: 999px;
      border: none;
      padding: 10px 18px;
      font-size: 0.95rem;
      cursor: pointer;
      background: #22c55e;
      color: #052e16;
      font-weight: 600;
      box-shadow: 0 10px 25px rgba(34,197,94,0.35);
      transition: transform 0.08s ease, box-shadow 0.08s ease, background 0.1s ease;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    button.secondary {
      background: #1f2937;
      color: #e5e7eb;
      box-shadow: 0 8px 20px rgba(15,23,42,0.7);
    }
    button:active {
      transform: translateY(1px) scale(0.99);
      box-shadow: 0 5px 14px rgba(0,0,0,0.5);
    }
    button[disabled] {
      opacity: 0.6;
      cursor: default;
      box-shadow: none;
    }
    .hint {
      font-size: 0.9rem;
      opacity: 0.8;
      text-align: center;
      margin-bottom: 10px;
    }
    .progress-wrap {
      margin: 12px 0 4px;
    }
    .progress-bar-bg {
      width: 100%;
      height: 10px;
      border-radius: 999px;
      background: #020617;
      overflow: hidden;
      border: 1px solid #1e293b;
    }
    .progress-bar {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #22c55e, #a3e635);
      transition: width 0.1s linear;
    }
    .progress-text {
      font-size: 0.85rem;
      text-align: right;
      opacity: 0.75;
      margin-top: 4px;
    }
    .layout {
      margin-top: 16px;
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 0.9fr);
      gap: 18px;
    }
    @media (max-width: 900px) {
      .layout {
        grid-template-columns: 1fr;
      }
    }
    .summary {
      background: #020617;
      border-radius: 14px;
      padding: 14px 16px;
      border: 1px solid #1f2937;
      min-height: 260px;
    }
    .summary h2 {
      font-size: 1.05rem;
      margin: 0 0 8px;
    }
    .summary-row {
      display: flex;
      justify-content: space-between;
      font-size: 0.93rem;
      margin: 3px 0;
    }
    .summary-row span.label {
      opacity: 0.8;
    }
    .summary-row span.value {
      font-weight: 600;
    }
    .categories {
      margin-top: 10px;
      font-size: 0.9rem;
    }
    .categories h3 {
      font-size: 0.95rem;
      margin: 4px 0 6px;
    }
    .categories-row {
      display: flex;
      justify-content: space-between;
      margin: 2px 0;
      opacity: 0.9;
    }
    .animal-card {
      background: radial-gradient(circle at top, #22c55e22, #020617);
      border-radius: 14px;
      padding: 14px 16px;
      border: 1px solid #1f2937;
      text-align: center;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .animal-name {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 6px;
    }
    .animal-message {
      margin: 20px 0;
      color: #d93025;
      font-weight: bold;
      border: 2px solid #d93025;
      padding: 10px;
      border-radius: 10px;
    }
    .animal-img {
      width: 120px;
      height: 120px;
      border-radius: 16px;
      object-fit: cover;
      border: 1px solid #1f2937;
      background: #020617;
      margin-bottom: 6px;
    }
    .footer-note {
      margin-top: 16px;
      font-size: 0.8rem;
      opacity: 0.7;
      text-align: center;
    }
    .badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 3px 8px;
      border-radius: 999px;
      background: #1e293b;
      font-size: 0.75rem;
      margin-bottom: 6px;
    }

    /* === –ö–∞–º–µ—Ä–∞ === */
    .camera-section {
      margin-top: 12px;
      text-align: center;
      width: 100%;
    }
    .camera-controls {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: center;
      margin-bottom: 8px;
    }
    .camera-view {
      margin-top: 6px;
      position: relative;
      width: 100%;
      max-width: 320px;
      margin-left: auto;
      margin-right: auto;
    }
    .camera-view video,
    .camera-view canvas {
      width: 100%;
      border-radius: 12px;
      border: 1px solid #1f2937;
      background: #020617;
      display: block;
    }
    .camera-view img#maskPreview {
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
      height: 240px; /* —Ç–≤–æ—è –ø—Ä–∞–≤–∫–∞ */
      border-radius: 12px;
      pointer-events: none;
      opacity: 0.9;
      z-index: 3;
    }
    a#downloadLink {
      display: inline-block;
      margin-top: 6px;
      font-size: 0.85rem;
      text-decoration: none;
      padding: 6px 12px;
      border-radius: 999px;
      background: #1f2937;
      color: #e5e7eb;
    }
  </style>
</head>
<body>
<div class="app">
  <!--<h1>–ì—Ä–∞: —Å–∫—ñ–ª—å–∫–∏ –º—ñ—Å—Ü—è –∑–∞–π–º–∞—é—Ç—å —Ç–≤–æ—ó —Ñ–∞–π–ª–∏?</h1>-->
  <h1>üéí –©–æ –≤ —Ç–≤–æ—î–º—É —Ä—é–∫–∑–∞–∫—É?</h1>

  <div class="card">
    <p class="hint">
      –û–±–µ—Ä–∏ –ø–∞–ø–∫—É –Ω–∞ —Å–≤–æ—î–º—É –∫–æ–º–ø‚Äô—é—Ç–µ—Ä—ñ. –ú–∏ –ø–æ—Ä–∞—Ö—É—î–º–æ <b>—Ç—ñ–ª—å–∫–∏ —Ñ–æ—Ç–æ, –≤—ñ–¥–µ–æ, –¥–æ–∫—É–º–µ–Ω—Ç–∏, PDF, DBF —Ç–∞ —ñ–Ω—à—ñ –æ—Ñ—ñ—Å–Ω—ñ —Ñ–∞–π–ª–∏</b> ‚Äî –±–µ–∑ —Å–∏—Å—Ç–µ–º–Ω–∏—Ö.
    </p>

    <div class="controls">
      <!-- <button id="pickFilesBtn">üìÇ –û–±—Ä–∞—Ç–∏ —Ñ–∞–π–ª–∏</button> -->
      <button id="pickFolderBtn" class="secondary">üíª –û–±—Ä–∞—Ç–∏ –ø–∞–ø–∫—É / –¥–∏—Å–∫ –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É</button>
      <button id="resetBtn" class="secondary">üîÅ –°–∫–∏–Ω—É—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç</button>
    </div>

    <!-- –ø—Ä–∏—Ö–æ–≤–∞–Ω—ñ input-–∏ -->
    <!-- <input id="fileInput" type="file" multiple style="display:none" /> -->
    <input id="folderInput" type="file" webkitdirectory directory multiple style="display:none" />

    <div class="progress-wrap" id="progressSection" style="display:none;">
      <div class="progress-bar-bg">
        <div class="progress-bar" id="progressBar"></div>
      </div>
      <div class="progress-text" id="progressText">–ì–æ—Ç—É—î–º–æ—Å—å –¥–æ –ø—ñ–¥—Ä–∞—Ö—É–Ω–∫—É‚Ä¶</div>
    </div>

    <div class="layout" id="resultsSection" style="display:none;">
      <!-- –õ—ñ–≤–∞ —á–∞—Å—Ç–∏–Ω–∞: –ø—ñ–¥—Å—É–º–æ–∫ -->
      <div class="summary" id="summaryBlock">
        <div class="badge">–†–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª—ñ–∑—É</div>
        <h2>–ü—ñ–¥—Å—É–º–æ–∫ —Ñ–∞–π–ª—ñ–≤</h2>

        <div class="summary-row">
          <span class="label">–ö—ñ–ª—å–∫—ñ—Å—Ç—å —Ñ–∞–π–ª—ñ–≤:</span>
          <span class="value" id="fileCount">0</span>
        </div>
        <div class="summary-row">
          <span class="label">–ó–∞–≥–∞–ª—å–Ω–∏–π —Ä–æ–∑–º—ñ—Ä:</span>
          <span class="value" id="totalSize">0 –ú–ë</span>
        </div>
        <div class="summary-row">
          <span class="label">–û—Ä—ñ—î–Ω—Ç–æ–≤–Ω–∏–π —Ä–æ–∑–º—ñ—Ä —É –ì–ë:</span>
          <span class="value" id="totalSizeGB">0 –ì–ë</span>
        </div>

        <div class="categories">
          <h3>–ó–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è–º–∏</h3>
          <div id="categoriesList"></div>
        </div>
      </div>

      <!-- –ü—Ä–∞–≤–∞ —á–∞—Å—Ç–∏–Ω–∞: —Ç–≤–∞—Ä–∏–Ω–∫–∞ + –∫–∞–º–µ—Ä–∞ -->
      <div class="animal-card" id="animalBlock">
        <div class="badge">–Ü–≥—Ä–æ–≤–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è</div>
        <div class="animal-name" id="animalName">–ü–æ–∫–∏ —â–æ —Ç–∏—Ö–æ‚Ä¶</div>
        <img id="animalImage" class="animal-img" alt="–¢–≤–∞—Ä–∏–Ω–∫–∞" />
        <div class="animal-message" id="animalMessage">
          –û–±–µ—Ä–∏ –ø–∞–ø–∫—É –∞–±–æ —Ñ–∞–π–ª–∏, —â–æ–± –¥—ñ–∑–Ω–∞—Ç–∏—Å—è, —Ö—Ç–æ —Å—å–æ–≥–æ–¥–Ω—ñ –¥–æ —Ç–µ–±–µ –∑–∞–≤—ñ—Ç–∞—î: –∑–∞–π—á–∏–∫, —î–Ω–æ—Ç —á–∏ –æ–ª–µ–Ω—å üê∞ü¶ùü¶å
        </div>

        <div class="camera-section">
          <div class="badge">–°–µ–ª—Ñ—ñ –∑ —Ç–≤–∞—Ä–∏–Ω–∫–æ—é</div>
          <div class="camera-controls">
            <button id="startCameraBtn" class="secondary">üé• –£–≤—ñ–º–∫–Ω—É—Ç–∏ –∫–∞–º–µ—Ä—É</button>
            <button id="takePhotoBtn" disabled>üì∏ –ó—Ä–æ–±–∏—Ç–∏ —Ñ–æ—Ç–æ</button>
            <button id="stopCameraBtn" class="secondary" disabled>‚èπ –ó—É–ø–∏–Ω–∏—Ç–∏ –∫–∞–º–µ—Ä—É</button>
          </div>
          <div class="camera-view">
            <video id="cameraVideo" autoplay playsinline style="display:none;"></video>
            <canvas id="photoCanvas" width="640" height="480" style="display:none;"></canvas>
            <img id="maskPreview" alt="–ú–∞—Å–∫–∞ —Ç–≤–∞—Ä–∏–Ω–∫–∏" style="display:none;">
          </div>
          <a id="downloadLink" href="#" style="display:none;">‚¨áÔ∏è –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ñ–æ—Ç–æ</a>
        </div>
      </div>
    </div>

    <div class="footer-note">
      –£—Å—ñ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫–∏ —Ç–∞ —Ä–æ–±–æ—Ç–∞ –∑ –∫–∞–º–µ—Ä–æ—é –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è <b>–ª–æ–∫–∞–ª—å–Ω–æ –≤ –±—Ä–∞—É–∑–µ—Ä—ñ</b>. –§–∞–π–ª–∏ —Ç–∞ —Ñ–æ—Ç–æ –Ω—ñ–∫—É–¥–∏ –Ω–µ –ø–µ—Ä–µ–¥–∞—é—Ç—å—Å—è.
    </div>
  </div>
</div>

<script>
  // ===== –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ç–∏–ø—ñ–≤ —Ñ–∞–π–ª—ñ–≤ =====
  const FILE_TYPES = {
    photo: ['jpg', 'jpeg', 'png', 'gif', 'webp', 'heic', 'raw', 'bmp'],
    video: ['mp4', 'mov', 'avi', 'mkv', 'webm'],
    docs: ['doc', 'docx', 'odt', 'rtf'],
    sheets: ['xls', 'xlsx', 'ods', 'csv', 'dbf'],
    pdf: ['pdf'],
    slides: ['ppt', 'pptx', 'odp'],
    text: ['txt', 'md']
  };

  const USER_EXT_SET = new Set(
    Object.values(FILE_TYPES).flat().map(ext => ext.toLowerCase())
  );

  const SYSTEM_PATH_PATTERNS = [
    'windows\\', 'program files', 'programdata', 'system32',
    '/usr/', '/bin/', '/sbin/', '/etc/', '/var/', '/opt/',
    '/library/', '/system/', 'application support'
  ];

  // –ú–∞—Å–∫–∏ –¥–ª—è –∫–æ–∂–Ω–æ—ó —Ç–≤–∞—Ä–∏–Ω–∫–∏
  const FRAME_FILES = {
    deer: 'deer_frame.png',
    bunny: 'bunny_frame.png',
    raccoon: 'raccoon_frame.png'
  };

  // ===== DOM-–µ–ª–µ–º–µ–Ω—Ç–∏ =====
//   const pickFilesBtn   = document.getElementById('pickFilesBtn');
  const pickFolderBtn  = document.getElementById('pickFolderBtn');
  const resetBtn       = document.getElementById('resetBtn');
//   const fileInput      = document.getElementById('fileInput');
  const folderInput    = document.getElementById('folderInput');

  const progressSection = document.getElementById('progressSection');
  const progressBar     = document.getElementById('progressBar');
  const progressText    = document.getElementById('progressText');

  const resultsSection  = document.getElementById('resultsSection');
  const fileCountEl     = document.getElementById('fileCount');
  const totalSizeEl     = document.getElementById('totalSize');
  const totalSizeGBEl   = document.getElementById('totalSizeGB');
  const categoriesList  = document.getElementById('categoriesList');

  const animalNameEl    = document.getElementById('animalName');
  const animalMsgEl     = document.getElementById('animalMessage');
  const animalImgEl     = document.getElementById('animalImage');

  const startCameraBtn  = document.getElementById('startCameraBtn');
  const stopCameraBtn   = document.getElementById('stopCameraBtn');
  const takePhotoBtn    = document.getElementById('takePhotoBtn');
  const videoEl         = document.getElementById('cameraVideo');
  const canvasEl        = document.getElementById('photoCanvas');
  const downloadLinkEl  = document.getElementById('downloadLink');
  const maskPreviewEl   = document.getElementById('maskPreview');

  let cameraStream = null;
  let currentAnimalType = null; // 'deer' | 'bunny' | 'raccoon'

  // ===== –î–æ–ø–æ–º—ñ–∂–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó =====
  function formatBytes(bytes) {
    if (bytes === 0) return '0 –ë';
    const k = 1024;
    const sizes = ['–ë', '–ö–ë', '–ú–ë', '–ì–ë', '–¢–ë'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    const value = (bytes / Math.pow(k, i)).toFixed(2);
    return `${value} ${sizes[i]}`;
  }

  function isSystemPath(path) {
    if (!path) return false;
    const lower = path.toLowerCase();
    return SYSTEM_PATH_PATTERNS.some(pattern => lower.includes(pattern));
  }

  function getExt(fileName) {
    const idx = fileName.lastIndexOf('.');
    if (idx === -1) return '';
    return fileName.slice(idx + 1).toLowerCase();
  }

  function classifyFile(file) {
    const ext = getExt(file.name);
    if (!USER_EXT_SET.has(ext)) return null;
    for (const [category, exts] of Object.entries(FILE_TYPES)) {
      if (exts.includes(ext)) return category;
    }
    return 'other';
  }

  function translateCategory(category) {
    const map = {
      photo: '–§–æ—Ç–æ',
      video: '–í—ñ–¥–µ–æ',
      docs: '–î–æ–∫—É–º–µ–Ω—Ç–∏',
      sheets: '–¢–∞–±–ª–∏—Ü—ñ / DBF',
      pdf: 'PDF',
      slides: '–ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü—ñ—ó',
      text: '–¢–µ–∫—Å—Ç–æ–≤—ñ —Ñ–∞–π–ª–∏',
      other: '–Ü–Ω—à–µ'
    };
    return map[category] || category;
  }

  function resetState() {
    progressSection.style.display = 'none';
    resultsSection.style.display  = 'none';
    progressBar.style.width       = '0%';
    progressText.textContent      = '';

    fileCountEl.textContent   = '0';
    totalSizeEl.textContent   = '0 –ú–ë';
    totalSizeGBEl.textContent = '0 –ì–ë';
    categoriesList.innerHTML  = '';

    animalNameEl.textContent = '–ü–æ–∫–∏ —â–æ —Ç–∏—Ö–æ‚Ä¶';
    animalMsgEl.textContent  =
      '–û–±–µ—Ä–∏ –ø–∞–ø–∫—É –∞–±–æ —Ñ–∞–π–ª–∏, —â–æ–± –¥—ñ–∑–Ω–∞—Ç–∏—Å—è, —Ö—Ç–æ —Å—å–æ–≥–æ–¥–Ω—ñ –¥–æ —Ç–µ–±–µ –∑–∞–≤—ñ—Ç–∞—î: –∑–∞–π—á–∏–∫, —î–Ω–æ—Ç —á–∏ –æ–ª–µ–Ω—å üê∞ü¶ùü¶å';
    animalImgEl.src = '';
    animalImgEl.alt = '–¢–≤–∞—Ä–∏–Ω–∫–∞';
    currentAnimalType = null;

    stopCamera();
    canvasEl.style.display = 'none';
    downloadLinkEl.style.display = 'none';
  }

  // ===== –û–±—Ä–æ–±–∫–∞ –≤–∏–±–æ—Ä—É —Ñ–∞–π–ª—ñ–≤ =====
//   pickFilesBtn.addEventListener('click', () => fileInput.click());
  pickFolderBtn.addEventListener('click', () => folderInput.click());
  resetBtn.addEventListener('click', resetState);

//   fileInput.addEventListener('change', () => handleFiles(fileInput.files));
  folderInput.addEventListener('change', () => handleFiles(folderInput.files));

  function handleFiles(fileList) {
    if (!fileList || fileList.length === 0) return;

    const files = Array.from(fileList);
    progressSection.style.display = 'block';
    resultsSection.style.display  = 'none';
    progressBar.style.width       = '0%';
    progressText.textContent      = '–ü—ñ–¥—Ä–∞—Ö—É–Ω–æ–∫ —Ñ–∞–π–ª—ñ–≤‚Ä¶';

    // pickFilesBtn.disabled  = true;
    pickFolderBtn.disabled = true;
    resetBtn.disabled      = true;

    const stats = {
      totalFiles: 0,
      totalBytes: 0,
      categories: {}
    };

    const total = files.length;
    let processed = 0;

    for (const key of Object.keys(FILE_TYPES)) {
      stats.categories[key] = { count: 0, bytes: 0 };
    }
    stats.categories.other = { count: 0, bytes: 0 };

    const batchSize = 400;

    function processBatch(start) {
      const end = Math.min(start + batchSize, total);
      for (let i = start; i < end; i++) {
        const file = files[i];
        const path = file.webkitRelativePath || file.name;

        if (isSystemPath(path)) {
          processed++;
          continue;
        }

        const category = classifyFile(file);
        if (!category) {
          processed++;
          continue;
        }

        stats.totalFiles++;
        stats.totalBytes += file.size;
        if (!stats.categories[category]) {
          stats.categories[category] = { count: 0, bytes: 0 };
        }
        stats.categories[category].count++;
        stats.categories[category].bytes += file.size;

        processed++;
      }

      const percent = Math.round((processed / total) * 100);
      progressBar.style.width  = `${percent}%`;
      progressText.textContent = `–û–ø—Ä–∞—Ü—å–æ–≤–∞–Ω–æ ${processed} –∑ ${total} —Ñ–∞–π–ª—ñ–≤ (${percent}%)`;

      if (processed < total) {
        window.requestAnimationFrame(() => processBatch(end));
      } else {
        finalizeStats(stats);
        // pickFilesBtn.disabled  = false;
        pickFolderBtn.disabled = false;
        resetBtn.disabled      = false;
      }
    }

    window.requestAnimationFrame(() => processBatch(0));
  }

  function finalizeStats(stats) {
    resultsSection.style.display = 'grid';

    fileCountEl.textContent = stats.totalFiles.toLocaleString('uk-UA');
    totalSizeEl.textContent = formatBytes(stats.totalBytes);

    const totalGB = stats.totalBytes / (1024 * 1024 * 1024);
    totalSizeGBEl.textContent = totalGB.toFixed(2) + ' –ì–ë';

    categoriesList.innerHTML = '';
    const entries = Object.entries(stats.categories)
      .filter(([_, v]) => v.count > 0)
      .sort((a, b) => b[1].bytes - a[1].bytes);

    if (entries.length === 0) {
      categoriesList.innerHTML =
        '<div style="opacity:0.7;">–ö–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫–∏—Ö —Ñ–∞–π–ª—ñ–≤ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ.</div>';
    } else {
      for (const [category, info] of entries) {
        const row = document.createElement('div');
        row.className = 'categories-row';
        row.innerHTML = `
          <span>${translateCategory(category)}</span>
          <span>${info.count.toLocaleString('uk-UA')} —à—Ç ¬∑ ${formatBytes(info.bytes)}</span>
        `;
        categoriesList.appendChild(row);
      }
    }

    updateAnimal(totalGB);
  }

  // ===== –í–∏–±—ñ—Ä —Ç–≤–∞—Ä–∏–Ω–∫–∏ =====
  function updateAnimal(totalGB) {
    const totalMB = totalGB * 1024;

    if (totalGB > 3) {
      currentAnimalType = 'deer';
      animalNameEl.textContent = '–û–ª–µ–Ω—å-–æ—Ö–æ—Ä–æ–Ω–µ—Ü—å ü¶å';
      animalMsgEl.textContent =
        `‚ö†Ô∏è –£–≤–∞–≥–∞: ${totalGB.toFixed(2)} GB —Ç–≤–æ—ó—Ö –æ—Å–æ–±–∏—Å—Ç–∏—Ö –¥–∞–Ω–∏—Ö –∑–Ω–∞—Ö–æ–¥—è—Ç—å—Å—è –ø—ñ–¥ –∑–∞–≥—Ä–æ–∑–æ—é –≤—Ç—Ä–∞—Ç–∏ –ø—Ä–∏ –ø–æ–ª–æ–º—Ü—ñ –¥–∏—Å–∫–∞! ` +
        '–ü–æ–¥—É–º–∞–π, —è–∫—ñ —Ñ–∞–π–ª–∏ –≤–∞—Ä—Ç–æ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –Ω–∞ Google –î–∏—Å–∫.';
      animalImgEl.src = 'deer.png';
      animalImgEl.alt = '–û–ª–µ–Ω—å';
    } else if (totalMB < 100) {
      currentAnimalType = 'bunny';
      animalNameEl.textContent = '–û–±–µ—Ä–µ–∂–Ω–∏–π –∑–∞–π—á–∏–∫ üê∞';
      animalMsgEl.textContent =
        `–£ —Ç–µ–±–µ –≤—Å—å–æ–≥–æ ${totalMB.toFixed(1)} –ú–ë —Ñ–∞–π–ª—ñ–≤. –¢–∏ –º–æ–ª–æ–¥–µ—Ü—å, –º–∞–π–∂–µ –Ω—ñ—á–æ–≥–æ –∑–∞–π–≤–æ–≥–æ! ` +
        '–í—Å–µ –æ–¥–Ω–æ –∫–æ—Ä–∏—Å–Ω–æ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ –∫–æ–ø—ñ—ó –≤–∞–∂–ª–∏–≤–∏—Ö —Ñ–∞–π–ª—ñ–≤ –Ω–∞ Google –î–∏—Å–∫.';
      animalImgEl.src = 'bunny.png';
      animalImgEl.alt = '–ó–∞–π—á–∏–∫';
    } else {
      currentAnimalType = 'raccoon';
      animalNameEl.textContent = '–•–∏—Ç—Ä–∏–π —î–Ω–æ—Ç ü¶ù';
      animalMsgEl.textContent =
        `‚ö†Ô∏è –£ —Ç–µ–±–µ –ø—Ä–∏–±–ª–∏–∑–Ω–æ ${totalGB.toFixed(2)} –ì–ë –æ—Å–æ–±–∏—Å—Ç–∏—Ö —Ñ–∞–π–ª—ñ–≤. –Ñ–Ω–æ—Ç –∫–∞–∂–µ, —â–æ —Ü–µ —Å–∫–∞—Ä–±! ` +
        '–ê–ª–µ —Ä–æ–±–æ—á—ñ —Ñ–∞–π–ª–∏ –∫—Ä–∞—â–µ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –Ω–∞ Google –î–∏—Å–∫, —â–æ–± –Ω–µ –∑–∞—Ö–∞—Ä–∞—â—É–≤–∞—Ç–∏ –∫–æ–º–ø‚Äô—é—Ç–µ—Ä.';
      animalImgEl.src = 'raccoon.png';
      animalImgEl.alt = '–Ñ–Ω–æ—Ç';
    }
  }

  // ===== –ö–∞–º–µ—Ä–∞ =====
  async function startCamera() {
    if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
      alert('–ö–∞–º–µ—Ä–∞ –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è –≤ —Ü—å–æ–º—É –±—Ä–∞—É–∑–µ—Ä—ñ.');
      return;
    }
    try {
      cameraStream = await navigator.mediaDevices.getUserMedia({ video: true });
      videoEl.srcObject = cameraStream;

      videoEl.onloadedmetadata = () => {
        canvasEl.width  = videoEl.videoWidth;
        canvasEl.height = videoEl.videoHeight;
      };

      videoEl.style.display = 'block';
      canvasEl.style.display = 'none';
      downloadLinkEl.style.display = 'none';

      const frameSrc = FRAME_FILES[currentAnimalType];
      if (frameSrc) {
        maskPreviewEl.src = frameSrc;
        maskPreviewEl.style.display = 'block';
      } else {
        maskPreviewEl.style.display = 'none';
      }

      startCameraBtn.disabled = true;
      stopCameraBtn.disabled = false;
      takePhotoBtn.disabled = false;
    } catch (err) {
      console.error(err);
      alert('–ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –∫–∞–º–µ—Ä–∏.');
    }
  }

  function stopCamera() {
    if (cameraStream) {
      cameraStream.getTracks().forEach(t => t.stop());
      cameraStream = null;
    }
    videoEl.srcObject = null;
    videoEl.style.display = 'none';
    maskPreviewEl.style.display = 'none';

    startCameraBtn.disabled = false;
    stopCameraBtn.disabled = true;
    takePhotoBtn.disabled = true;
  }

  function takePhoto() {
    if (!cameraStream) return;

    const ctx = canvasEl.getContext('2d');
    const width  = canvasEl.width;
    const height = canvasEl.height;

    // –∫–∞–¥—Ä –∑ –∫–∞–º–µ—Ä–∏
    ctx.drawImage(videoEl, 0, 0, width, height);

    const frameSrc = FRAME_FILES[currentAnimalType];

    if (frameSrc) {
      const frame = new Image();
      frame.onload = () => {
        ctx.drawImage(frame, 0, 0, width, height);
        finishPhoto();
      };
      frame.onerror = finishPhoto;
      frame.src = frameSrc;
    } else {
      finishPhoto();
    }

    function finishPhoto() {
      canvasEl.style.display = 'block';
      const dataURL = canvasEl.toDataURL('image/png');
      downloadLinkEl.href = dataURL;
      downloadLinkEl.download = 'my_animal_photo.png';
      downloadLinkEl.style.display = 'inline-block';
    }
  }

  startCameraBtn.addEventListener('click', startCamera);
  stopCameraBtn.addEventListener('click', stopCamera);
  takePhotoBtn.addEventListener('click', takePhoto);
</script>
</body>
</html>
